# Copyright (c) 2018-2019 Bitwise IO, Inc.
# Licensed under Creative Commons Attribution 4.0 International License
# https://creativecommons.org/licenses/by/4.0/
version: "2.1"

services:
  grid-website-jekyll:
    build:
      dockerfile: docker/jekyll.dockerfile
      context: .
    image: grid-website-jekyll
    container_name: grid-website-jekyll
    working_dir: /srv/jekyll/
    ports:
      - 4000:4000
    volumes:
      - $PWD:/srv/jekyll
    environment:
      - JEKYLL_ENV=${JEKYLL_ENV}
    entrypoint:  |
      bash -c "
        rm -rf  _site
        jekyll serve --config ./_config.yml
      "

  webserver:
    image: grid-website
    container_name: grid-website
    build:
      context: .
      dockerfile: webserver/Dockerfile
    working_dir: /srv/jekyll/
    entrypoint: /srv/jekyll/entrypoint-web.sh
    expose:
      - 80
    ports:
      - 8000:80
    volumes:
      - $PWD/generator:/srv/jekyll
    environment:
      - BUILDONLY=${BUILDONLY}
